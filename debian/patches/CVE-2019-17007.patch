Backported of:

# HG changeset patch
# User Dana Keeler <dkeeler@mozilla.com>
# Date 1553112229 25200
# Node ID 1473dd7efe2ce4f8722a33ebb03a3425e09887de
# Parent  e8136553ef86fb9dd04119ee66014f624fbcf18d
Bug 1533216 - check we actually got some certs in collect_certs r=jcj

Test Plan: https://treeherder.mozilla.org/#/jobs?repo=nss-try&revision=1b44b7588cb9a6806701394c08bf64d13f84b982

Reviewers: jcj

Reviewed By: jcj

Bug #: 1533216

Differential Revision: https://phabricator.services.mozilla.com/D23752
diff --git a/nss/lib/pkcs7/certread.c b/nss/lib/pkcs7/certread.c
index 2d692f1..3091f99 100644
--- a/nss/lib/pkcs7/certread.c
+++ b/nss/lib/pkcs7/certread.c
@@ -492,14 +492,16 @@ typedef struct {
 static SECStatus
 collect_certs(void *arg, SECItem **certs, int numcerts)
 {
-    SECStatus rv;
-    collect_args *collectArgs;
-
-    collectArgs = (collect_args *)arg;
-
-    rv = SECITEM_CopyItem(collectArgs->arena, &collectArgs->cert, *certs);
-
-    return (rv);
+    collect_args *collectArgs = (collect_args *)arg;
+    if (!collectArgs || !collectArgs->arena) {
+        PORT_SetError(SEC_ERROR_INVALID_ARGS);
+        return SECFailure;
+    }
+    if (numcerts < 1 || !certs || !*certs) {
+        PORT_SetError(SEC_ERROR_BAD_DER);
+        return SECFailure;
+    }
+    return SECITEM_CopyItem(collectArgs->arena, &collectArgs->cert, *certs);
 }
 
 /*
